<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Device‐Tilt Letter Scaling</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
  <style>
    body { margin: 0; overflow: hidden; background: #000; color: #fff; }
    #motionBtn { position: absolute; top: 20px; left: 20px; z-index: 10; }
  </style>
</head>
<body>
  <button id="motionBtn">Enable Motion Effects</button>
  <script>
   // ——— Your Letters ———
    let letters = ["i", "c", "z", "b", "g", "v"];

    // ——— Motion / Permission Logic ———
    let permissionGranted = false;
    const deadZone        = 1;     // ignore tiny tilts
    const smoothingFactor = 0.15;  // low‐pass filter constant
    const updateInterval  = 50;    // ms between updates
    const maxTilt         = 45;    // tilt (in degrees) maps fully to collapse

    // 1) Start fully “zoomed out” at 13×
    let lastScaleFactorY = 13;
    let lastUpdateTime   = 0;

    // Button → permission request
    function requestMotionPermission() {
      if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission()
          .then(response => {
            if (response === 'granted') {
              enableMotion();
            } else {
              console.warn('Motion permission denied');
            }
          })
          .catch(err => console.error('Permission error:', err));
      } else {
        // No permission API
        enableMotion();
      }
    }

    function enableMotion() {
      permissionGranted = true;
      document.getElementById('motionBtn').style.display = 'none';
      window.addEventListener('deviceorientation', handleOrientation);
    }

    // Handle left/right tilt to collapse from 13→0.2
    function handleOrientation(event) {
      if (!permissionGranted) return;
      const tiltLR = event.gamma;  // negative = left, positive = right

      if (Math.abs(tiltLR) < deadZone) return;
      const now = Date.now();
      if (now - lastUpdateTime < updateInterval) return;
      lastUpdateTime = now;

      // Normalize |tilt| to [0,1] based on maxTilt
      const t = Math.min(Math.abs(tiltLR), maxTilt) / maxTilt;

      // Interpolate: 0 → 13, 1 → 0.2
      let rawScaleY = 13 - t * (13 - 0.2);

      // Clamp and smooth
      rawScaleY = Math.min(Math.max(rawScaleY, 0.2), 13);
      lastScaleFactorY += smoothingFactor * (rawScaleY - lastScaleFactorY);
    }
    // ——————————————————————————————

    function setup() {
      createCanvas(windowWidth, windowHeight);
      textSize(128);
      textAlign(CENTER, CENTER);
      fill(255);
      noStroke();
      textLeading(textSize() * 0.8);

      // Wire up the permission button
      select('#motionBtn').mousePressed(requestMotionPermission);
    }

    function draw() {
      background(0);

      // Apply the current smoothed Y‐scale
      push();
        translate(width/2, height/2);
        scale(lastScaleFactorY, 1);

        // Draw the column of letters
        for (let i = 0; i < letters.length; i++) {
          let y = (i - (letters.length - 1) / 2) * textLeading();
          text(letters[i], 0, y);
        }
      pop();
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }
  </script>
</body>
</html>
